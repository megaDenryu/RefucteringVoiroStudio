


from api.LLM.LLMAPIBase.LLMInterface.QueryProxy import QueryProxy, クエリ段落
from api.LLM.エージェント.会話用エージェント.自立型Ver1.体.BrainModule.脳内思考プロセス.記憶部署 import 記憶部署
from api.LLM.エージェント.会話用エージェント.自立型Ver1.体.BrainModule.脳内思考プロセス.状況統合.状況オブジェクト import 状況履歴
from api.LLM.エージェント.会話用エージェント.自立型Ver1.体を持つ者.自分の情報.I自分の情報 import I自分の情報コンテナ


class 創造的連想クエリプロキシ(QueryProxy):
    def __init__(self, v状況履歴: 状況履歴, vキャラクター情報:I自分の情報コンテナ, v思考履歴: 記憶部署) -> None:
        self._クエリプロキシ = [
            クエリ段落("キャラクター情報", vキャラクター情報),
            クエリ段落("思考履歴", v思考履歴),
            クエリ段落("状況履歴", v状況履歴),
            クエリ段落("指示", self.指示文),
        ]

    @property
    def 指示文(self) -> str:
        return """
キャラクターの現在の状況、キャラクター情報、最近の思考履歴を**出発点**として、**自由な連想のフロー**を生成してください。

連想には、以下のような要素を自由に取り入れてください：
-   心に浮かんだ具体的な**イメージ**や**情景**
-   ふと思い出した**記憶の断片**
-   関連する**言葉**や**フレーズ**
-   突飛な**アイデア**や**「もしも」のシナリオ**
-   比喩や**シンボル**
-   連想から生まれた**素朴な問いかけ**（例：「これは何かに似てる？」「なぜこれを思い出したんだろう？」）
-   連想に伴う**感情のきらめき**（例：懐かしい、面白い、少し不安など）

**重視すること：**
-   論理的な一貫性や結論よりも、**発想の飛躍、意外な結びつき、連想の連鎖**。
-   思考が拡散し、多方向に展開していく様子。
-   キャラクターの状況や内面状態が**かすかに反映**されていること（直接的でなくても良い）。

**出力形式：**
指定されたJSONスキーマに従い、連想のフローを構造化して出力してください。
"""

    @property
    def 指示文2(self) -> str:
        return """
キャラクターが持つ情報や思考を基に、創造的な連想を生成してください。
特に、キャラクターの背景や状況に関連する新しいアイデアや視点を考慮してください。
このプロセスでは、キャラクターの内面的な葛藤や感情も考慮し、連想がキャラクターの内面的変化に寄与するようにしてください。
"""
